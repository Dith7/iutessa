{% extends 'administration/base.html' %}

{% block title %}{{ title }}{% endblock %}

{% block breadcrumb_items %}
<li><i class="fas fa-chevron-right text-gray-400 mx-2"></i></li>
<li><a href="{% url 'administration:blocks_list' %}" class="text-green-600 hover:text-green-800 cursor-pointer">Blocs</a></li>
<li><i class="fas fa-chevron-right text-gray-400 mx-2"></i></li>
<li class="text-gray-500">{{ title }}</li>
{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto">
    <!-- Header -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">{{ title }}</h1>
        <p class="text-gray-600">Configuration et paramètres du bloc</p>
    </div>

    <form method="post" enctype="multipart/form-data" class="space-y-6">
        {% csrf_token %}
        
        <!-- Main Information -->
        <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
            <div class="p-6 border-b border-gray-100">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900">Informations Principales</h3>
                        <p class="text-sm text-gray-600">Titre, type et configuration de base</p>
                    </div>
                    <div class="w-8 h-8 bg-green-50 rounded-lg flex items-center justify-center">
                        <i class="fas fa-info-circle text-green-600 text-sm"></i>
                    </div>
                </div>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">{{ form.title.label }}</label>
                        <input type="text" name="{{ form.title.name }}" value="{{ form.title.value|default:'' }}" 
                               class="w-full px-3 py-2.5 border border-gray-300 rounded-lg text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-smooth cursor-text"
                               {% if form.title.field.required %}required{% endif %}>
                        {% if form.title.errors %}
                            <p class="text-red-500 text-sm mt-1">{{ form.title.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">{{ form.subtitle.label }}</label>
                        <input type="text" name="{{ form.subtitle.name }}" value="{{ form.subtitle.value|default:'' }}" 
                               class="w-full px-3 py-2.5 border border-gray-300 rounded-lg text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-smooth cursor-text"
                               {% if form.subtitle.field.required %}required{% endif %}>
                        {% if form.subtitle.errors %}
                            <p class="text-red-500 text-sm mt-1">{{ form.subtitle.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">{{ form.block_type.label }}</label>
                        <select name="{{ form.block_type.name }}" class="w-full px-3 py-2.5 border border-gray-300 rounded-lg text-gray-900 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-smooth cursor-pointer" {% if form.block_type.field.required %}required{% endif %}>
                            {% for value, label in form.block_type.field.choices %}
                            <option value="{{ value }}" {% if form.block_type.value == value %}selected{% endif %}>{{ label }}</option>
                            {% endfor %}
                        </select>
                        {% if form.block_type.errors %}
                            <p class="text-red-500 text-sm mt-1">{{ form.block_type.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">{{ form.status.label }}</label>
                        <select name="{{ form.status.name }}" class="w-full px-3 py-2.5 border border-gray-300 rounded-lg text-gray-900 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-smooth cursor-pointer" {% if form.status.field.required %}required{% endif %}>
                            {% for value, label in form.status.field.choices %}
                            <option value="{{ value }}" {% if form.status.value == value %}selected{% endif %}>{{ label }}</option>
                            {% endfor %}
                        </select>
                        {% if form.status.errors %}
                            <p class="text-red-500 text-sm mt-1">{{ form.status.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">{{ form.order.label }}</label>
                        <input type="number" name="{{ form.order.name }}" value="{{ form.order.value|default:'' }}" 
                               class="w-full px-3 py-2.5 border border-gray-300 rounded-lg text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-smooth cursor-text"
                               {% if form.order.field.required %}required{% endif %}>
                        {% if form.order.errors %}
                            <p class="text-red-500 text-sm mt-1">{{ form.order.errors.0 }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Content -->
        <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
            <div class="p-6 border-b border-gray-100">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900">Contenu</h3>
                        <p class="text-sm text-gray-600">Texte principal du bloc</p>
                    </div>
                    <div class="w-8 h-8 bg-blue-50 rounded-lg flex items-center justify-center">
                        <i class="fas fa-edit text-blue-600 text-sm"></i>
                    </div>
                </div>
            </div>
            <div class="p-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">{{ form.content.label }}</label>
                    <textarea name="{{ form.content.name }}" rows="6" 
                              class="w-full px-3 py-2.5 border border-gray-300 rounded-lg text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-smooth resize-none cursor-text"
                              {% if form.content.field.required %}required{% endif %}>{{ form.content.value|default:'' }}</textarea>
                    {% if form.content.errors %}
                        <p class="text-red-500 text-sm mt-1">{{ form.content.errors.0 }}</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Media -->
        <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
            <div class="p-6 border-b border-gray-100">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900">Médias</h3>
                        <p class="text-sm text-gray-600">Images, documents et vidéos</p>
                    </div>
                    <div class="w-8 h-8 bg-purple-50 rounded-lg flex items-center justify-center">
                        <i class="fas fa-images text-purple-600 text-sm"></i>
                    </div>
                </div>
            </div>
            
            <!-- Media Tabs -->
            <div x-data="{ activeTab: 'image' }" class="p-6">
                <div class="border-b border-gray-100 mb-6">
                    <nav class="-mb-px flex space-x-8">
                        <button @click="activeTab = 'image'" type="button"
                                :class="activeTab === 'image' ? 'border-green-500 text-green-600' : 'border-transparent text-gray-500 hover:text-gray-700'"
                                class="whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm transition-smooth cursor-pointer">
                            <i class="fas fa-image mr-2"></i>Image
                        </button>
                        <button @click="activeTab = 'document'" type="button"
                                :class="activeTab === 'document' ? 'border-green-500 text-green-600' : 'border-transparent text-gray-500 hover:text-gray-700'"
                                class="whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm transition-smooth cursor-pointer">
                            <i class="fas fa-file mr-2"></i>Document
                        </button>
                        <button @click="activeTab = 'video'" type="button"
                                :class="activeTab === 'video' ? 'border-green-500 text-green-600' : 'border-transparent text-gray-500 hover:text-gray-700'"
                                class="whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm transition-smooth cursor-pointer">
                            <i class="fas fa-video mr-2"></i>Vidéo
                        </button>
                    </nav>
                </div>
                
                <!-- Image Tab -->
                <div x-show="activeTab === 'image'" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">{{ form.image.label }}</label>
                        <input type="file" name="{{ form.image.name }}" accept="image/*"
                               class="w-full px-3 py-2.5 border border-gray-300 rounded-lg text-gray-900 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-smooth cursor-pointer">
                        {% if form.image.errors %}
                            <p class="text-red-500 text-sm mt-1">{{ form.image.errors.0 }}</p>
                        {% endif %}
                        {% if block and block.image %}
                        <div class="mt-4">
                            <img src="{{ block.image.url }}" alt="Current image" class="h-32 w-auto rounded-xl border shadow-lg">
                        </div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Document Tab -->
                <div x-show="activeTab === 'document'" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">{{ form.document.label }}</label>
                        <input type="file" name="{{ form.document.name }}"
                               class="w-full px-3 py-2.5 border border-gray-300 rounded-lg text-gray-900 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-smooth cursor-pointer">
                        {% if form.document.errors %}
                            <p class="text-red-500 text-sm mt-1">{{ form.document.errors.0 }}</p>
                        {% endif %}
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">{{ form.document_title.label }}</label>
                        <input type="text" name="{{ form.document_title.name }}" value="{{ form.document_title.value|default:'' }}"
                               class="w-full px-3 py-2.5 border border-gray-300 rounded-lg text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-smooth cursor-text">
                        {% if form.document_title.errors %}
                            <p class="text-red-500 text-sm mt-1">{{ form.document_title.errors.0 }}</p>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Video Tab -->
                <div x-show="activeTab === 'video'" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">{{ form.video_type.label }}</label>
                        <select name="{{ form.video_type.name }}" id="id_video_type" class="w-full px-3 py-2.5 border border-gray-300 rounded-lg text-gray-900 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-smooth cursor-pointer">
                            {% for value, label in form.video_type.field.choices %}
                            <option value="{{ value }}" {% if form.video_type.value == value %}selected{% endif %}>{{ label }}</option>
                            {% endfor %}
                        </select>
                        {% if form.video_type.errors %}
                            <p class="text-red-500 text-sm mt-1">{{ form.video_type.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div id="video-local" class="video-field">
                        <label class="block text-sm font-medium text-gray-700 mb-2">{{ form.video_file.label }}</label>
                        <input type="file" name="{{ form.video_file.name }}" accept="video/*"
                               class="w-full px-3 py-2.5 border border-gray-300 rounded-lg text-gray-900 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-smooth cursor-pointer">
                        {% if form.video_file.errors %}
                            <p class="text-red-500 text-sm mt-1">{{ form.video_file.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div id="video-url" class="video-field">
                        <label class="block text-sm font-medium text-gray-700 mb-2">{{ form.video_url.label }}</label>
                        <input type="url" name="{{ form.video_url.name }}" value="{{ form.video_url.value|default:'' }}"
                               class="w-full px-3 py-2.5 border border-gray-300 rounded-lg text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-smooth cursor-text">
                        {% if form.video_url.errors %}
                            <p class="text-red-500 text-sm mt-1">{{ form.video_url.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div id="video-embed" class="video-field">
                        <label class="block text-sm font-medium text-gray-700 mb-2">{{ form.video_embed_code.label }}</label>
                        <textarea name="{{ form.video_embed_code.name }}" rows="4"
                                  class="w-full px-3 py-2.5 border border-gray-300 rounded-lg text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-smooth resize-none cursor-text">{{ form.video_embed_code.value|default:'' }}</textarea>
                        {% if form.video_embed_code.errors %}
                            <p class="text-red-500 text-sm mt-1">{{ form.video_embed_code.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">{{ form.video_thumbnail.label }}</label>
                        <input type="file" name="{{ form.video_thumbnail.name }}" accept="image/*"
                               class="w-full px-3 py-2.5 border border-gray-300 rounded-lg text-gray-900 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-smooth cursor-pointer">
                        {% if form.video_thumbnail.errors %}
                            <p class="text-red-500 text-sm mt-1">{{ form.video_thumbnail.errors.0 }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Links -->
        <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
            <div class="p-6 border-b border-gray-100">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900">Lien Optionnel</h3>
                        <p class="text-sm text-gray-600">Ajouter un lien externe</p>
                    </div>
                    <div class="w-8 h-8 bg-orange-50 rounded-lg flex items-center justify-center">
                        <i class="fas fa-link text-orange-600 text-sm"></i>
                    </div>
                </div>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">{{ form.link_url.label }}</label>
                        <input type="url" name="{{ form.link_url.name }}" value="{{ form.link_url.value|default:'' }}"
                               class="w-full px-3 py-2.5 border border-gray-300 rounded-lg text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-smooth cursor-text">
                        {% if form.link_url.errors %}
                            <p class="text-red-500 text-sm mt-1">{{ form.link_url.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">{{ form.link_text.label }}</label>
                        <input type="text" name="{{ form.link_text.name }}" value="{{ form.link_text.value|default:'' }}"
                               class="w-full px-3 py-2.5 border border-gray-300 rounded-lg text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-smooth cursor-text">
                        {% if form.link_text.errors %}
                            <p class="text-red-500 text-sm mt-1">{{ form.link_text.errors.0 }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Actions -->
        <div class="flex justify-between items-center">
            <a href="{% url 'administration:blocks_list' %}" class="px-6 py-3 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-smooth cursor-pointer">
                <i class="fas fa-arrow-left mr-2"></i>Retour
            </a>
            
            <div class="flex space-x-4">
                {% if block and block.pk %}
                <a href="{% url 'administration:block_detail' block.pk %}" target="_blank" class="px-6 py-3 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-smooth cursor-pointer">
                    <i class="fas fa-eye mr-2"></i>Prévisualiser
                </a>
                {% endif %}
                
                <button type="submit" class="btn-gradient px-6 py-3 text-white rounded-lg font-medium cursor-pointer">
                    <i class="fas fa-save mr-2"></i>Enregistrer
                </button>
            </div>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Conditional video fields management
document.addEventListener('DOMContentLoaded', function() {
    const videoTypeSelect = document.getElementById('id_video_type');
    const videoFields = {
        'local': document.getElementById('video-local'),
        'youtube': document.getElementById('video-url'),
        'vimeo': document.getElementById('video-url'),
        'embed': document.getElementById('video-embed')
    };
    
    function toggleVideoFields() {
        const selectedType = videoTypeSelect ? videoTypeSelect.value : '';
        
        // Hide all fields
        Object.values(videoFields).forEach(field => {
            if (field) field.style.display = 'none';
        });
        
        // Show appropriate field
        if (videoFields[selectedType]) {
            videoFields[selectedType].style.display = 'block';
        }
    }
    
    if (videoTypeSelect) {
        videoTypeSelect.addEventListener('change', toggleVideoFields);
        toggleVideoFields(); // Execute on load
    }
});
</script>
{% endblock %}