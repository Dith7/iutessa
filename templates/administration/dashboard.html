{% extends 'administration/base.html' %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<!-- Header Section -->
<div class="mb-8">
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Dashboard</h1>
            <p class="text-gray-600">Vue d'ensemble de votre écosystème universitaire</p>
        </div>
    </div>
</div>

<!-- Stats Cards -->
<div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6 mb-8">
    <!-- Total Étudiants -->
    <div class="bg-white rounded-xl border border-gray-200 p-6 hover:shadow-md transition-shadow">
        <div class="flex items-center justify-between mb-4">
            <div class="w-12 h-12 bg-green-50 rounded-lg flex items-center justify-center">
                <i class="fas fa-user-graduate text-green-600 text-xl"></i>
            </div>
            <div class="text-right">
                <div class="text-2xl font-bold text-gray-900">{{ academic_stats.total_etudiants|default:0 }}</div>
                <div class="text-xs text-gray-500">Étudiants</div>
            </div>
        </div>
        <div class="text-sm text-gray-600">{{ academic_stats.etudiants_valides|default:0 }} validés</div>
        <div class="mt-3 flex items-center text-xs text-green-600">
            <i class="fas fa-arrow-up mr-1"></i>
            +5% ce mois
        </div>
    </div>

    <!-- Filières Actives -->
    <div class="bg-white rounded-xl border border-gray-200 p-6 hover:shadow-md transition-shadow">
        <div class="flex items-center justify-between mb-4">
            <div class="w-12 h-12 bg-blue-50 rounded-lg flex items-center justify-center">
                <i class="fas fa-graduation-cap text-blue-600 text-xl"></i>
            </div>
            <div class="text-right">
                <div class="text-2xl font-bold text-gray-900">{{ academic_stats.filieres_actives|default:0 }}</div>
                <div class="text-xs text-gray-500">Filières</div>
            </div>
        </div>
        <div class="text-sm text-gray-600">sur {{ academic_stats.total_filieres|default:0 }} total</div>
        <div class="mt-3 flex items-center text-xs text-blue-600">
            <i class="fas fa-check mr-1"></i>
            Toutes actives
        </div>
    </div>

    <!-- Documents en attente -->
    <div class="bg-white rounded-xl border border-gray-200 p-6 hover:shadow-md transition-shadow">
        <div class="flex items-center justify-between mb-4">
            <div class="w-12 h-12 bg-orange-50 rounded-lg flex items-center justify-center">
                <i class="fas fa-file-alt text-orange-600 text-xl"></i>
            </div>
            <div class="text-right">
                <div class="text-2xl font-bold text-gray-900">{{ academic_stats.documents_en_attente|default:0 }}</div>
                <div class="text-xs text-gray-500">Documents</div>
            </div>
        </div>
        <div class="text-sm text-gray-600">À valider</div>
        <div class="mt-3 flex items-center text-xs text-orange-600">
            <i class="fas fa-clock mr-1"></i>
            En attente
        </div>
    </div>

    <!-- Total Blocs -->
    <div class="bg-white rounded-xl border border-gray-200 p-6 hover:shadow-md transition-shadow">
        <div class="flex items-center justify-between mb-4">
            <div class="w-12 h-12 bg-purple-50 rounded-lg flex items-center justify-center">
                <i class="fas fa-th-large text-purple-600 text-xl"></i>
            </div>
            <div class="text-right">
                <div class="text-2xl font-bold text-gray-900">{{ stats.total_blocks|default:0 }}</div>
                <div class="text-xs text-gray-500">Blocs</div>
            </div>
        </div>
        <div class="text-sm text-gray-600">{{ stats.active_blocks|default:0 }} actifs</div>
        <div class="mt-3 flex items-center text-xs text-purple-600">
            <i class="fas fa-star mr-1"></i>
            Contenu géré
        </div>
    </div>
</div>

<!-- Main Content Grid -->
<div class="grid grid-cols-1 xl:grid-cols-3 gap-6 mb-8">
    <!-- Top Filières -->
    <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
        <div class="p-6 border-b border-gray-100">
            <div class="flex items-center justify-between">
                <div>
                    <h3 class="text-lg font-semibold text-gray-900">Top Filières</h3>
                    <p class="text-sm text-gray-600">Les plus demandées</p>
                </div>
                <div class="w-8 h-8 bg-green-50 rounded-lg flex items-center justify-center">
                    <i class="fas fa-trophy text-green-600 text-sm"></i>
                </div>
            </div>
        </div>
        <div class="p-6">
            <div class="space-y-4">
                {% for filiere in top_filieres %}
                <div class="flex items-center justify-between py-3">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-gray-100 rounded-lg flex items-center justify-center">
                            <span class="text-gray-700 font-medium text-xs">{{ filiere.code }}</span>
                        </div>
                        <div>
                            <p class="font-medium text-gray-900 text-sm">{{ filiere.nom|truncatechars:20 }}</p>
                            <p class="text-xs text-gray-500">{{ filiere.nb_etudiants }} étudiants</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-lg font-semibold text-gray-900">{{ filiere.taux_occupation|floatformat:0 }}%</p>
                    </div>
                </div>
                {% empty %}
                <div class="text-center py-8 text-gray-500">
                    <i class="fas fa-graduation-cap text-2xl mb-2 opacity-50"></i>
                    <p class="text-sm">Aucune filière disponible</p>
                </div>
                {% endfor %}
            </div>
        </div>
        {% if top_filieres %}
        <div class="px-6 py-4 bg-gray-50 border-t border-gray-100">
            <a href="{% url 'academique:admin_filieres_list' %}" class="text-sm font-medium text-green-600 hover:text-green-700 flex items-center">
                Gérer les filières <i class="fas fa-arrow-right ml-2 text-xs"></i>
            </a>
        </div>
        {% endif %}
    </div>

    <!-- Nouvelles Inscriptions -->
    <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
        <div class="p-6 border-b border-gray-100">
            <div class="flex items-center justify-between">
                <div>
                    <h3 class="text-lg font-semibold text-gray-900">Nouvelles Inscriptions</h3>
                    <p class="text-sm text-gray-600">Derniers étudiants</p>
                </div>
                <div class="w-8 h-8 bg-blue-50 rounded-lg flex items-center justify-center">
                    <i class="fas fa-user-plus text-blue-600 text-sm"></i>
                </div>
            </div>
        </div>
        <div class="p-6">
            <div class="space-y-4">
                {% for etudiant in recent_etudiants %}
                <div class="flex items-center space-x-3 py-2">
                    <div class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center flex-shrink-0">
                        <span class="text-gray-700 font-medium text-xs">{{ etudiant.nom|first }}{{ etudiant.prenoms|first }}</span>
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="font-medium text-gray-900 text-sm truncate">{{ etudiant.nom_complet }}</p>
                        <div class="flex items-center justify-between mt-1">
                            <span class="text-xs text-gray-500">{{ etudiant.filiere.code }}</span>
                            <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium
                                {% if etudiant.statut_validation == 'valide' %}bg-green-100 text-green-700
                                {% elif etudiant.statut_validation == 'en_attente' %}bg-yellow-100 text-yellow-700
                                {% else %}bg-red-100 text-red-700{% endif %}">
                                {{ etudiant.get_statut_validation_display }}
                            </span>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="text-center py-8 text-gray-500">
                    <i class="fas fa-user-graduate text-2xl mb-2 opacity-50"></i>
                    <p class="text-sm">Aucune nouvelle inscription</p>
                </div>
                {% endfor %}
            </div>
        </div>
        {% if recent_etudiants %}
        <div class="px-6 py-4 bg-gray-50 border-t border-gray-100">
            <a href="{% url 'academique:admin_etudiants_list' %}" class="text-sm font-medium text-blue-600 hover:text-blue-700 flex items-center">
                Voir tous les étudiants <i class="fas fa-arrow-right ml-2 text-xs"></i>
            </a>
        </div>
        {% endif %}
    </div>

    <!-- Activité des Blocs -->
    <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
        <div class="p-6 border-b border-gray-100">
            <div class="flex items-center justify-between">
                <div>
                    <h3 class="text-lg font-semibold text-gray-900">Activité Récente</h3>
                    <p class="text-sm text-gray-600">Dernières modifications</p>
                </div>
                <div class="w-8 h-8 bg-purple-50 rounded-lg flex items-center justify-center">
                    <i class="fas fa-clock text-purple-600 text-sm"></i>
                </div>
            </div>
        </div>
        <div class="p-6">
            <div class="space-y-4">
                {% for block in recent_blocks %}
                <div class="flex items-center space-x-3 py-2">
                    <div class="w-8 h-8 bg-gray-100 rounded-lg flex items-center justify-center flex-shrink-0">
                        <span class="text-gray-700 font-medium text-xs">{{ block.title|first|upper }}</span>
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="font-medium text-gray-900 text-sm truncate">{{ block.title }}</p>
                        <div class="flex items-center justify-between mt-1">
                            <span class="text-xs text-gray-500">{{ block.get_block_type_display }}</span>
                            <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium
                                {% if block.status == 'active' %}bg-green-100 text-green-700{% else %}bg-gray-100 text-gray-700{% endif %}">
                                {{ block.get_status_display }}
                            </span>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="text-center py-8 text-gray-500">
                    <i class="fas fa-th-large text-2xl mb-2 opacity-50"></i>
                    <p class="text-sm">Aucun bloc récent</p>
                </div>
                {% endfor %}
            </div>
        </div>
        {% if recent_blocks %}
        <div class="px-6 py-4 bg-gray-50 border-t border-gray-100">
            <a href="{% url 'administration:blocks_list' %}" class="text-sm font-medium text-purple-600 hover:text-purple-700 flex items-center">
                Gérer les blocs <i class="fas fa-arrow-right ml-2 text-xs"></i>
            </a>
        </div>
        {% endif %}
    </div>
</div>

<!-- Quick Actions -->
<div class="mb-8">
    <div class="flex items-center justify-between mb-6">
        <div>
            <h3 class="text-xl font-semibold text-gray-900">Actions Rapides</h3>
            <p class="text-sm text-gray-600">Raccourcis vers les tâches courantes</p>
        </div>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <a href="{% url 'academique:admin_filieres_list' %}" class="group p-6 bg-white border border-gray-200 rounded-xl hover:shadow-md hover:border-green-200 transition-all">
            <div class="flex items-center space-x-4">
                <div class="w-12 h-12 bg-green-50 group-hover:bg-green-100 rounded-xl flex items-center justify-center transition-colors">
                    <i class="fas fa-graduation-cap text-green-600 text-xl"></i>
                </div>
                <div>
                    <h4 class="font-semibold text-gray-900 group-hover:text-green-600 transition-colors">Filières</h4>
                    <p class="text-sm text-gray-600">Gestion des programmes</p>
                </div>
            </div>
        </a>

        <a href="{% url 'academique:admin_etudiants_list' %}" class="group p-6 bg-white border border-gray-200 rounded-xl hover:shadow-md hover:border-blue-200 transition-all">
            <div class="flex items-center space-x-4">
                <div class="w-12 h-12 bg-blue-50 group-hover:bg-blue-100 rounded-xl flex items-center justify-center transition-colors">
                    <i class="fas fa-users text-blue-600 text-xl"></i>
                </div>
                <div>
                    <h4 class="font-semibold text-gray-900 group-hover:text-blue-600 transition-colors">Étudiants</h4>
                    <p class="text-sm text-gray-600">Gestion des dossiers</p>
                </div>
            </div>
        </a>

        <a href="{% url 'administration:blocks_list' %}" class="group p-6 bg-white border border-gray-200 rounded-xl hover:shadow-md hover:border-purple-200 transition-all">
            <div class="flex items-center space-x-4">
                <div class="w-12 h-12 bg-purple-50 group-hover:bg-purple-100 rounded-xl flex items-center justify-center transition-colors">
                    <i class="fas fa-th-large text-purple-600 text-xl"></i>
                </div>
                <div>
                    <h4 class="font-semibold text-gray-900 group-hover:text-purple-600 transition-colors">Blocs</h4>
                    <p class="text-sm text-gray-600">Contenu du site</p>
                </div>
            </div>
        </a>

        <a href="{% url 'administration:block_create' %}" class="group p-6 bg-white border border-gray-200 rounded-xl hover:shadow-md hover:border-gray-300 transition-all">
            <div class="flex items-center space-x-4">
                <div class="w-12 h-12 bg-gray-50 group-hover:bg-gray-100 rounded-xl flex items-center justify-center transition-colors">
                    <i class="fas fa-plus text-gray-600 text-xl"></i>
                </div>
                <div>
                    <h4 class="font-semibold text-gray-900 group-hover:text-gray-700 transition-colors">Nouveau Bloc</h4>
                    <p class="text-sm text-gray-600">Créer du contenu</p>
                </div>
            </div>
        </a>
    </div>
</div>

<!-- Bottom Stats -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Blocs par type -->
    <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
        <div class="p-6 border-b border-gray-100">
            <h3 class="text-lg font-semibold text-gray-900">Types de Blocs</h3>
            <p class="text-sm text-gray-600">Répartition du contenu</p>
        </div>
        <div class="p-6">
            <div class="space-y-3">
                {% for block_type in blocks_by_type %}
                <div class="flex items-center justify-between py-2">
                    <span class="text-sm text-gray-700">{{ block_type.block_type|capfirst }}</span>
                    <span class="text-lg font-semibold text-gray-900">{{ block_type.count }}</span>
                </div>
                {% empty %}
                <div class="text-center py-8 text-gray-500">
                    <p class="text-sm">Aucun bloc disponible</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- System Info -->
    <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
        <div class="p-6 border-b border-gray-100">
            <h3 class="text-lg font-semibold text-gray-900">Informations Système</h3>
            <p class="text-sm text-gray-600">État de votre environnement</p>
        </div>
        <div class="p-6">
            <div class="space-y-4">
                <div class="flex items-center justify-between py-2">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-blue-50 rounded-lg flex items-center justify-center">
                            <i class="fas fa-hdd text-blue-600 text-sm"></i>
                        </div>
                        <span class="text-sm text-gray-700">Espace Utilisé</span>
                    </div>
                    <span class="text-sm font-semibold text-gray-900">{{ media_size|default:0 }} MB</span>
                </div>
                
                <div class="flex items-center justify-between py-2">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-green-50 rounded-lg flex items-center justify-center">
                            <i class="fab fa-python text-green-600 text-sm"></i>
                        </div>
                        <span class="text-sm text-gray-700">Django Version</span>
                    </div>
                    <span class="text-sm font-semibold text-gray-900">5.2+</span>
                </div>
                
                <div class="flex items-center justify-between py-2">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-gray-50 rounded-lg flex items-center justify-center">
                            <i class="fas fa-cogs text-gray-600 text-sm"></i>
                        </div>
                        <span class="text-sm text-gray-700">Environnement</span>
                    </div>
                    <span class="text-sm font-semibold 
                        {% if debug %}text-amber-600{% else %}text-green-600{% endif %}">
                        {% if debug %}Development{% else %}Production{% endif %}
                    </span>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}