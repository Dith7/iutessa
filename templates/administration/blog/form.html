{% extends 'administration/base.html' %}

{% block title %}{{ action }} un article{% endblock %}

{% block breadcrumb_items %}
<li><i class="fas fa-chevron-right text-gray-400 mx-2"></i></li>
<li class="text-gray-500">Blog</li>
<li><i class="fas fa-chevron-right text-gray-400 mx-2"></i></li>
<li class="text-gray-500">{{ action }}</li>
{% endblock %}

{% block content %}
<div class="mb-8">
    <h1 class="text-4xl font-bold text-gradient-iut mb-2">{{ action }} un article</h1>
</div>

<form method="post" enctype="multipart/form-data" class="space-y-6">
    {% csrf_token %}
    
    <!-- Informations principales -->
    <div class="bg-white/90 backdrop-blur-xl rounded-3xl p-8 shadow-xl border border-green-100">
        <h3 class="text-xl font-bold text-gray-900 mb-6">Informations principales</h3>
        
        <div class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Titre *</label>
                {{ form.title }}
                {% if form.title.errors %}
                <p class="mt-1 text-sm text-red-600">{{ form.title.errors.0 }}</p>
                {% endif %}
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Image à la une</label>
                {{ form.featured_image }}
                {% if post.featured_image %}
                <img src="{{ post.featured_image.url }}" alt="" class="mt-2 h-32 rounded-lg">
                {% endif %}
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Extrait *</label>
                {{ form.excerpt }}
                <p class="mt-1 text-sm text-gray-500">Maximum 300 caractères</p>
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Contenu *</label>
                {{ form.content }}
            </div>
        </div>
    </div>
    
    <!-- Médias supplémentaires -->
    <div class="bg-white/90 backdrop-blur-xl rounded-3xl p-8 shadow-xl border border-green-100">
        <h3 class="text-xl font-bold text-gray-900 mb-6">Médias</h3>
        
        <div class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Vidéo YouTube/Vimeo</label>
                {{ form.video_url }}
                <p class="mt-1 text-sm text-gray-500">Coller l'URL complète (ex: https://www.youtube.com/watch?v=...)</p>
            </div>
            
            <div class="text-center text-gray-500 py-2">— OU —</div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Fichier vidéo local</label>
                {{ form.video_file }}
                <p class="mt-1 text-sm text-gray-500">Formats: MP4, WebM (max 50MB)</p>
            </div>
        </div>
        
        <!-- Galerie d'images -->
        <div class="mt-8">
            <h4 class="text-lg font-semibold text-gray-900 mb-4">Galerie d'images</h4>
            {{ image_formset.management_form }}
            <div id="image-formset" class="space-y-4">
                {% for form in image_formset %}
                <div class="flex gap-4 items-start p-4 bg-gray-50 rounded-lg">
                    <div class="flex-1 space-y-2">
                        {{ form.id }}
                        {{ form.image }}
                        {{ form.caption }}
                        {{ form.order }}
                    </div>
                    {% if form.instance.image %}
                    <img src="{{ form.instance.image.url }}" class="w-20 h-20 rounded object-cover">
                    {% endif %}
                    <div>
                        {{ form.DELETE }}
                        <label>Supprimer</label>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        
        <!-- Documents -->
        <div class="mt-8">
            <h4 class="text-lg font-semibold text-gray-900 mb-4">Documents PDF</h4>
            {{ document_formset.management_form }}
            <div id="document-formset" class="space-y-4">
                {% for form in document_formset %}
                <div class="p-4 bg-gray-50 rounded-lg space-y-2">
                    {{ form.id }}
                    {{ form.title }}
                    {{ form.file }}
                    {{ form.description }}
                    {{ form.order }}
                    <div>
                        {{ form.DELETE }}
                        <label>Supprimer</label>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    
    <!-- Classification -->
    <div class="bg-white/90 backdrop-blur-xl rounded-3xl p-8 shadow-xl border border-green-100">
        <h3 class="text-xl font-bold text-gray-900 mb-6">Classification</h3>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Catégorie</label>
                {{ form.category }}
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Tags</label>
                {{ form.tags }}
                <p class="mt-1 text-sm text-gray-500">Séparer par des virgules</p>
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Statut</label>
                {{ form.status }}
            </div>
        </div>
    </div>
    
    <!-- Boutons -->
    <div class="flex justify-end gap-4">
        <a href="{% url 'administration:blog_management' %}" class="px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50">
            Annuler
        </a>
        <button type="submit" class="btn-gradient text-white px-8 py-3 rounded-lg font-medium">
            <i class="fas fa-save mr-2"></i>{{ action }}
        </button>
    </div>
</form>

{% endblock %}