{% extends 'base.html' %}
{% load static %}

{% block title %}{{ post.title }}{% endblock %}

{% block content %}
<!-- Hero -->
<section class="relative bg-[#192f59] py-16">
    <div class="max-w-[1140px] mx-auto px-4 text-white">
        <p class="text-sm uppercase tracking-wider mb-3">{{ post.category.name|default:"Article" }}</p>
        <h1 class="text-5xl font-bold">{{ post.title }}</h1>
        <div class="flex gap-4 text-sm mt-4 opacity-80">
            <span>{{ post.published_at|date:"d F Y" }}</span>
            <span>Par {{ post.author.get_full_name }}</span>
            <span>{{ comments.count }} commentaire{{ comments.count|pluralize }}</span>
        </div>
    </div>
</section>

<section class="bg-[#f7f7f7] py-16">
    <div class="max-w-[1140px] mx-auto px-4">
        <div class="flex flex-col lg:flex-row gap-8">
            <!-- Contenu principal -->
            <div class="lg:w-2/3">
                <div class="bg-white rounded-lg shadow-md overflow-hidden">
                    {% if post.featured_image %}
                    <img src="{{ post.featured_image.url }}" class="w-full h-96 object-cover">
                    {% endif %}
                    
                    <div class="p-10">
                        <!-- Vidéo -->
                        {% if post.get_video_embed_url %}
                        <iframe src="{{ post.get_video_embed_url }}" class="w-full h-[400px] mb-6"></iframe>
                        {% elif post.video_file %}
                        <video controls class="w-full mb-6"><source src="{{ post.video_file.url }}"></video>
                        {% endif %}

                        <!-- Contenu -->
                        <div class="prose max-w-none text-gray-700">
                            {{ post.content|safe }}
                        </div>

                        <!-- Galerie -->
                        {% if post.images.exists %}
                        <div class="grid grid-cols-2 gap-4 my-8">
                            {% for img in post.images.all %}
                            <img src="{{ img.image.url }}" class="rounded-lg">
                            {% endfor %}
                        </div>
                        {% endif %}

                        <!-- Documents -->
                        {% if post.documents.exists %}
                        <div class="my-8 space-y-3">
                            <h4 class="text-xl font-bold text-[#192f59]">Documents</h4>
                            {% for doc in post.documents.all %}
                            <a href="{{ doc.file.url }}" download class="flex items-center gap-3 p-4 bg-gray-100 rounded hover:bg-gray-200">
                                <i class="fas fa-file-pdf text-red-600 text-2xl"></i>
                                <div>
                                    <p class="font-semibold">{{ doc.title }}</p>
                                    <p class="text-sm text-gray-600">{{ doc.get_file_size }}</p>
                                </div>
                            </a>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Commentaires -->
                <div class="bg-white rounded-lg shadow-md p-10 mt-8">
                    <h3 class="text-2xl font-bold text-[#192f59] mb-6">{{ comments.count }} Commentaire{{ comments.count|pluralize }}</h3>
                    
                    {% for c in comments %}
                    <div class="flex gap-4 mb-6 pb-6 border-b">
                        <div class="w-12 h-12 bg-[#3db166] rounded-full flex items-center justify-center text-white font-bold">
                            {{ c.author_name|first|upper }}
                        </div>
                        <div class="flex-1">
                            <p class="font-semibold">{{ c.author_name }}</p>
                            <p class="text-sm text-gray-500 mb-2">{{ c.created_at|date:"d M Y" }}</p>
                            <p class="text-gray-700">{{ c.content }}</p>
                        </div>
                    </div>
                    {% endfor %}

                    <form method="post" class="mt-8">
                        {% csrf_token %}
                        <textarea name="content" rows="4" placeholder="Votre commentaire..." class="w-full p-4 border rounded mb-4"></textarea>
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <input type="text" name="name" placeholder="Nom" class="p-3 border rounded">
                            <input type="email" name="email" placeholder="Email" class="p-3 border rounded">
                        </div>
                        <button class="bg-[#3db166] hover:bg-[#35a05c] text-white px-8 py-3 rounded">Publier</button>
                    </form>
                </div>
            </div>

            <!-- Sidebar -->
            <aside class="lg:w-1/3">
                <div class="bg-white p-8 rounded-lg shadow-md">
                    <h3 class="text-xl font-bold text-[#192f59] mb-4 pb-4 border-b-2 border-[#3db166]">Articles Récents</h3>
                    {% for recent in related_posts %}
                    <a href="{{ recent.get_absolute_url }}" class="block mb-4 hover:text-[#3db166]">
                        <p class="font-semibold">{{ recent.title|truncatewords:8 }}</p>
                        <p class="text-sm text-gray-500">{{ recent.published_at|date:"d M Y" }}</p>
                    </a>
                    {% endfor %}
                </div>
            </aside>
        </div>
    </div>
</section>
{% endblock %}