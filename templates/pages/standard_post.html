{% extends 'base.html' %}
{% load static %}

{% block title %}{{ post.title }} - IUTESSA{% endblock %}

{% block extra_css %}
<style>
    .post-hero { background-attachment: fixed; background-size: cover; background-position: center; }
    .date-badge { background: white; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); }
    .article-content h5, .article-content h6 { margin-top: 2rem; margin-bottom: 1rem; }
    .article-content p { margin-bottom: 1.5rem; }
    .article-content blockquote { border-left: 4px solid #3db166; padding-left: 2rem; margin: 2rem 0; font-style: italic; color: #555; }
    .article-content ul { list-style: disc; margin-left: 2rem; margin-bottom: 1.5rem; }
    .article-content img { max-width: 100%; height: auto; }
</style>
{% endblock %}

{% block content %}

<!-- Hero -->
<section class="post-hero relative bg-cover bg-center" style="background-image: url('{% if post.featured_image %}{{ post.featured_image.url }}{% else %}{% static 'images/blog/post-hero.jpg' %}{% endif %}');">
    <div class="absolute inset-0 bg-gradient-to-b from-black/20 to-black/70"></div>
    <div class="relative max-w-[1140px] mx-auto px-4 pt-96 pb-20">
        <div class="flex gap-6 items-start">
            <div class="date-badge text-center rounded-lg p-4 w-24">
                <div class="text-4xl font-bold text-[#192f59]">{{ post.published_at|date:"d" }}</div>
                <div class="text-sm text-gray-600 uppercase">{{ post.published_at|date:"M" }}</div>
            </div>
            
            <div class="flex-1">
                <h1 class="text-5xl font-bold text-white mb-6">{{ post.title }}</h1>
                <div class="flex flex-wrap gap-4 text-white text-sm">
                    <span>Par {{ post.author.get_full_name }}</span>
                    {% if post.category %}<span>{{ post.category.name }}</span>{% endif %}
                    {% for tag in post.get_tags_list %}<span>#{{ tag }}</span>{% endfor %}
                    <span><i class="far fa-comments mr-1"></i>{{ comments.count }} Commentaire{{ comments.count|pluralize }}</span>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Breadcrumbs -->
<div class="bg-white border-b border-gray-200">
    <div class="max-w-[1140px] mx-auto px-4 py-4">
        <div class="flex items-center gap-2 text-sm text-gray-600">
            <a href="{% url 'pages:home' %}" class="hover:text-[#3db166]">Accueil</a>
            <i class="fas fa-chevron-right text-xs"></i>
            <a href="{% url 'pages:blog' %}" class="hover:text-[#3db166]">Blog</a>
            <i class="fas fa-chevron-right text-xs"></i>
            <span class="text-gray-800">{{ post.title|truncatewords:5 }}</span>
        </div>
    </div>
</div>

<!-- Content -->
<section class="bg-white py-16">
    <div class="max-w-[900px] mx-auto px-4">
        
        <!-- Vidéo -->
        {% if post.video_url or post.video_file %}
        <div class="mb-8">
            {% if post.video_url %}
            <iframe src="{{ post.get_video_embed_url }}" class="w-full h-[500px] rounded-lg" frameborder="0" allowfullscreen></iframe>
            {% elif post.video_file %}
            <video controls class="w-full rounded-lg"><source src="{{ post.video_file.url }}"></video>
            {% endif %}
        </div>
        {% endif %}
        
        <!-- Article -->
        <article class="article-content prose max-w-none">
            {{ post.content|safe }}
        </article>

        <!-- Galerie -->
        {% if post.images.exists %}
        <div class="my-12 grid grid-cols-1 md:grid-cols-2 gap-4">
            {% for img in post.images.all %}
            <img src="{{ img.image.url }}" alt="{{ img.caption }}" class="rounded-lg">
            {% endfor %}
        </div>
        {% endif %}

        <!-- Documents -->
        {% if post.documents.exists %}
        <div class="my-12 space-y-4">
            <h3 class="text-2xl font-bold text-[#192f59]">Documents</h3>
            {% for doc in post.documents.all %}
            <a href="{{ doc.file.url }}" download class="flex items-center gap-4 p-4 bg-gray-50 rounded-lg hover:bg-gray-100">
                <i class="fas fa-file-pdf text-3xl text-red-600"></i>
                <div>
                    <p class="font-semibold">{{ doc.title }}</p>
                    <p class="text-sm text-gray-600">{{ doc.get_file_size }}</p>
                </div>
            </a>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Commentaires -->
        <div class="mt-16 pt-8 border-t">
            <h3 class="text-3xl font-bold text-[#192f59] mb-8">{{ comments.count }} Commentaire{{ comments.count|pluralize }}</h3>

            {% for comment in comments %}
            <div class="flex gap-6 mb-8">
                <div class="w-20 h-20 bg-[#3db166] rounded-full flex items-center justify-center text-white text-2xl font-bold">
                    {{ comment.author_name|first|upper }}
                </div>
                <div class="flex-1 bg-gray-50 p-6 rounded-lg">
                    <h5 class="font-bold text-[#192f59] text-lg">{{ comment.author_name }}</h5>
                    <div class="text-sm text-gray-600 mb-3">{{ comment.created_at|date:"d F Y à H:i" }}</div>
                    <p class="text-gray-700">{{ comment.content }}</p>
                </div>
            </div>
            {% endfor %}

            <!-- Formulaire -->
            <div class="bg-white border border-gray-200 rounded-lg p-8 mt-8">
                <h4 class="text-2xl font-bold text-[#192f59] mb-6">Laisser un Commentaire</h4>
                <form method="post" class="space-y-6">
                    {% csrf_token %}
                    <textarea name="content" rows="6" placeholder="Votre commentaire*" required class="w-full p-4 border rounded"></textarea>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <input type="text" name="name" placeholder="Nom*" required class="p-4 border rounded">
                        <input type="email" name="email" placeholder="Email*" required class="p-4 border rounded">
                    </div>
                    <button type="submit" class="bg-[#3db166] hover:bg-[#35a05c] text-white px-10 py-4 rounded font-semibold">
                        Publier
                    </button>
                </form>
            </div>
        </div>
    </div>
</section>

{% endblock %}